<!DOCTYPE html>
<html>
  <body>
    <script src="ExpressionParser.js"></script>
    <script>
    var access = {
      'A': true,
      'B': true,
      'C': false
    };

    var parser = new ExpressionParser({
      termDelegate: function(term) {
        return access[term];
      }
    });

    var assert = function(val) {
      if (!val) {
        throw "Assertion Failed";
      }
    }

    assert(parser.evaluateExpression('(A AND B) OR NOT C'));
    assert(!parser.evaluateExpression('A AND C'));  
    assert(parser.evaluateExpression('A AND NOT C'));
    assert(!parser.evaluateExpression('A AND NOT (C OR B)'));

    var arithmeticLanguage = {
      INFIX_OPS: {
        '+': function(a, b) {
          return a + b;
        },
        '-': function(a, b) {
          return a - b;
        },
        '*': function(a, b) {
          return a * b;
        },
        '/': function(a, b) {
          return a / b;
        },
        ',': function(a, b) {
          return [a] + b;
        }
      },
      PREFIX_OPS: {
        'SQRT': function(expr) {
          return Math.sqrt(expr);
        },
        'POW': function(expr) {
          console.log(expr);
          return Math.pow(expr[0], expr[1]);
        }
      },
      PRECEDENCE: [['SQRT', 'POW'], ['*', '/'], ['+', '-'], [',']],
      GROUP_OPEN: '(',
      GROUP_CLOSE: ')',
      SEPARATOR: ' ',
      SYMBOLS: ['(', ')', '+', '-', '*', '/', ','],

      termDelegate: function(term) {
        return parseInt(term);
      }
    };

    var expr = 'pow(1 + 1 * 2 - (10 / 2) + sqrt(16), 2)';

    parser = new ExpressionParser(arithmeticLanguage);

    console.log(expr);
    expr = expr.toUpperCase();
    console.log(parser.expressionToRpn(expr));
    console.log(parser.rpnToExpression(parser.expressionToRpn(expr)));
    console.log(parser.evaluateExpression(expr));
    assert(parser.evaluateExpression(expr) === 4);

    console.log("All Tests Passed!");
    </script>
  </body>
</html>
